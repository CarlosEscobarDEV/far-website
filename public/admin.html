<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panou Control - FAR</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #D4E5F0;
            margin: 0;
            padding: 0;
        }

        .site-header {
            background: linear-gradient(to bottom, #1E90FF, #1C86EE, #1874CD);
            padding: 10px 2rem;
            color: white;
            border-bottom: 2px solid #00008B;
        }
        .logo {
            font-weight: 900;
            font-size: 2.5rem;
            letter-spacing: -2px;
        }
        .logo span {
            background: linear-gradient(to right, #FFA500, #FF4500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: inline-block;
        }
        .main-nav a {
            padding: 5px 10px;
            border-radius: 5px;
            transition: background-color 0.2s;
        }
        .main-nav a:hover {
            background-color: rgba(255,255,255,0.2);
        }

        .content-area {
            padding: 2rem;
            background-color: white;
            max-width: 1152px;
            margin: 2rem auto;
            border-radius: 8px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.15);
        }
        .content-title {
            font-size: 1.8rem;
            font-weight: 900;
            border-bottom: 3px solid #E0E0E0;
            padding-bottom: 5px;
            margin-bottom: 1.5rem;
        }
        
        .frutiger-input, .frutiger-select, .frutiger-textarea {
            border: 1px solid #ACA899;
            padding: 0.75rem;
            border-radius: 5px;
            background-color: #F0F0F0;
            transition: all 0.2s;
            width: 100%;
        }
        .frutiger-input:focus, .frutiger-select:focus, .frutiger-textarea:focus {
            outline: none;
            border-color: #0055E3;
            background-color: white;
        }
        .frutiger-button {
            color: white;
            font-weight: bold;
            padding: 0.75rem;
            border-radius: 5px;
            transition: all 0.2s;
            text-align: center;
            display: block;
            width: 100%;
        }
        .frutiger-button:hover {
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .btn-green { background: linear-gradient(to bottom, #4CAF50, #45a049); border: 1px solid #3e8e41; }
        .btn-blue { background: linear-gradient(to bottom, #2196F3, #1e88e5); border: 1px solid #1976d2; }
        .btn-red { background: linear-gradient(to bottom, #f44336, #d32f2f); border: 1px solid #c62828; }
        .btn-darkred { background: linear-gradient(to bottom, #b71c1c, #9a1a1a); border: 1px solid #880e0e; }
    </style>
</head>
<body>

    <!-- Header -->
    <header class="site-header">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <a href="/" class="logo">frutiger <span>AERO</span></a>
            <nav class="main-nav flex space-x-4 text-lg font-bold">
                <a href="/">Acasă</a>
                <a id="logout-button" href="#" class="cursor-pointer">Deconectare</a>
            </nav>
        </div>
    </header>
    
    <!-- Zona de continut principal -->
    <main class="content-area">
        <h1 class="content-title text-gray-800 mb-8">Panou de Control Administrator</h1>

        <!-- Notificari -->
        <div id="notification" class="hidden p-4 rounded-lg text-center font-semibold mb-6"></div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Coloana Stanga: Articole si Anunturi -->
            <div class="space-y-8">
                <!-- Management Articole -->
                <section>
                    <h2 class="content-title">Management Articole</h2>
                    <form id="article-form" class="space-y-4">
                        <div>
                            <label for="article-category" class="block text-sm font-bold text-gray-700 mb-2">Categorie</label>
                            <select id="article-category" required class="frutiger-select"></select>
                        </div>
                        <div>
                            <label for="article-title" class="block text-sm font-bold text-gray-700 mb-2">Titlu</label>
                            <input type="text" id="article-title" required class="frutiger-input">
                        </div>
                        <div>
                            <label for="article-imageUrl" class="block text-sm font-bold text-gray-700 mb-2">URL Imagine</label>
                            <input type="url" id="article-imageUrl" placeholder="https://..." required class="frutiger-input">
                        </div>
                        <div>
                            <label for="article-content" class="block text-sm font-bold text-gray-700 mb-2">Conținut</label>
                            <textarea id="article-content" required rows="6" class="frutiger-textarea"></textarea>
                        </div>
                        <button type="submit" class="frutiger-button btn-green">Publică Articol</button>
                    </form>
                </section>
                
                <!-- Anunturi -->
                <section>
                    <h2 class="content-title">Comunicări pe Server</h2>
                    <form id="announcement-form" class="space-y-4">
                        <div>
                            <label for="announcement-title" class="block text-sm font-bold text-gray-700 mb-2">Titlu Anunț</label>
                            <input type="text" id="announcement-title" required class="frutiger-input">
                        </div>
                        <div>
                            <label for="announcement-message" class="block text-sm font-bold text-gray-700 mb-2">Mesaj</label>
                            <textarea id="announcement-message" required rows="4" class="frutiger-textarea"></textarea>
                        </div>
                        <button type="submit" class="frutiger-button btn-blue">Trimite Anunț</button>
                    </form>
                </section>
            </div>

            <!-- Coloana Dreapta: Management Membri -->
            <div class="space-y-8">
                <!-- Kick Membru -->
                <section>
                    <h2 class="content-title">Management Membri</h2>
                    <form id="kick-form" class="space-y-4">
                        <h3 class="font-bold text-xl">Kick Membru</h3>
                        <div>
                            <label for="kick-userId" class="block text-sm font-bold text-gray-700 mb-2">Selectează Membrul</label>
                            <select id="kick-userId" required class="frutiger-select"><option>Se încarcă...</option></select>
                        </div>
                        <div>
                            <label for="kick-reason" class="block text-sm font-bold text-gray-700 mb-2">Motiv</label>
                            <input type="text" id="kick-reason" class="frutiger-input">
                        </div>
                        <button type="submit" class="frutiger-button btn-red">Execută Kick</button>
                    </form>
                </section>
                
                <!-- Ban Membru -->
                <section>
                     <form id="ban-form" class="space-y-4 mt-8">
                        <h3 class="font-bold text-xl">Ban Membru</h3>
                        <div>
                            <label for="ban-userId" class="block text-sm font-bold text-gray-700 mb-2">Selectează Membrul</label>
                            <select id="ban-userId" required class="frutiger-select"><option>Se încarcă...</option></select>
                        </div>
                        <div>
                            <label for="ban-reason" class="block text-sm font-bold text-gray-700 mb-2">Motiv</label>
                            <input type="text" id="ban-reason" class="frutiger-input">
                        </div>
                        <button type="submit" class="frutiger-button btn-darkred">Execută BAN</button>
                    </form>
                </section>
            </div>
        </div>
    </main>

    <script>
        // Verificare si deconectare
        if (sessionStorage.getItem('far_admin_logged_in') !== 'true') { window.location.href = '/login.html'; }
        document.getElementById('logout-button').addEventListener('click', () => {
            sessionStorage.removeItem('far_admin_logged_in');
            window.location.href = '/login.html';
        });

        const guildId = '1182289349841272873';
        const notification = document.getElementById('notification');
        const categories = [
             { name: 'Hypermarket Real', value: 'hypermarket-real' }, { name: 'PIC Hypermarket', value: 'pic-hypermarket' },
            { name: 'Domo Romania', value: 'domo-romania' }, { name: 'Cosmote Romania', value: 'cosmote-romania' },
            { name: 'Flanco World', value: 'flanco-world' }, { name: 'Praktiker Romania', value: 'praktiker-romania' },
            { name: 'SPAR Romania', value: 'spar-romania' }, { name: 'Penny Market XXL', value: 'penny-market-xxl' },
            { name: 'Billa Romania', value: 'billa-romania' }, { name: 'Baumax Romania', value: 'baumax-romania' },
            { name: 'Romtelecom Romania', value: 'romtelecom-romania' }, { name: 'Cora', value: 'cora' },
            { name: 'Obi Romania', value: 'obi-romania' }, { name: 'Plus Discount', value: 'plus-discount' },
            { name: 'Euro GSM', value: 'euro-gsm' }, { name: 'Flanco', value: 'flanco' },
            { name: 'Germanos', value: 'germanos' }, { name: 'Demax Market', value: 'demax-market' },
            { name: 'Arhiva PROFI', value: 'arhiva-profi' }, { name: 'Brico Store', value: 'brico-store' },
            { name: 'Despre Frutiger Aero', value: 'despre-frutiger-aero' }, { name: 'General', value: 'general' }
        ];

        // Popularea selectului de categorii
        const categorySelect = document.getElementById('article-category');
        categorySelect.innerHTML = '<option value="">Alege o categorie...</option>';
        categories.forEach(cat => {
            const option = document.createElement('option');
            option.value = cat.value;
            option.textContent = cat.name;
            categorySelect.appendChild(option);
        });

        // Incarcarea listei de membri
        window.addEventListener('load', async () => {
            try {
                const response = await fetch(`/members/${guildId}`);
                if (!response.ok) { throw new Error('Eroare la încărcarea membrilor.'); }
                const members = await response.json();
                
                const kickSelect = document.getElementById('kick-userId');
                const banSelect = document.getElementById('ban-userId');
                kickSelect.innerHTML = '<option value="">Alege un membru...</option>';
                banSelect.innerHTML = '<option value="">Alege un membru...</option>';

                members.forEach(member => {
                    const option = document.createElement('option');
                    option.value = member.id;
                    option.textContent = `${member.displayName} (${member.name})`;
                    kickSelect.appendChild(option.cloneNode(true));
                    banSelect.appendChild(option.cloneNode(true));
                });
            } catch (error) { showNotification(error.message, 'error'); }
        });
        
        // Handlers pentru formulare
        document.getElementById('article-form').addEventListener('submit', e => handleFormSubmit(e, '/api/articles', {
            category: document.getElementById('article-category').value,
            title: document.getElementById('article-title').value,
            imageUrl: document.getElementById('article-imageUrl').value,
            content: document.getElementById('article-content').value,
        }));
        document.getElementById('kick-form').addEventListener('submit', e => handleFormSubmit(e, '/kick', { guildId, userId: document.getElementById('kick-userId').value, reason: document.getElementById('kick-reason').value }));
        document.getElementById('ban-form').addEventListener('submit', e => handleFormSubmit(e, '/ban', { guildId, userId: document.getElementById('ban-userId').value, reason: document.getElementById('ban-reason').value }));
        document.getElementById('announcement-form').addEventListener('submit', e => handleFormSubmit(e, '/announcement', { title: document.getElementById('announcement-title').value, message: document.getElementById('announcement-message').value }));

        // Functie generica de submit
        async function handleFormSubmit(event, endpoint, body) {
            event.preventDefault();
            const form = event.target;
            if (body.hasOwnProperty('userId') && body.userId === "") { return showNotification("Trebuie să selectezi un membru.", "error"); }
            if (body.hasOwnProperty('category') && body.category === "") { return showNotification("Trebuie să selectezi o categorie.", "error"); }

            showNotification('Se procesează...', 'info');
            try {
                const response = await fetch(endpoint, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body) });
                const result = await response.json();
                if (response.ok) {
                    showNotification(result.message, 'success');
                    form.reset();
                } else { showNotification(`Eroare: ${result.message}`, 'error'); }
            } catch (error) { showNotification('Eroare de rețea.', 'error'); }
        }

        // Functie de notificare
        function showNotification(message, type) {
            notification.textContent = message;
            notification.className = 'p-4 rounded-lg text-center font-semibold mb-6';
            if (type === 'success') { notification.classList.add('bg-green-100', 'border', 'border-green-400', 'text-green-700'); }
            else if (type === 'error') { notification.classList.add('bg-red-100', 'border', 'border-red-400', 'text-red-700'); }
            else { notification.classList.add('bg-blue-100', 'border', 'border-blue-400', 'text-blue-700'); }
        }
    </script>
</body>
</html>